{% extends 'base.html.twig' %}

{% block title %}Actores{% endblock %}

{% block body %}

<!-- HEADER + BUSCADOR + ORDEN -->
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">

    <div class="d-flex align-items-center gap-3">
        <h2 class="fw-bold mb-0">
            <i class="bi bi-people-fill text-primary me-2"></i> Actores
        </h2>
        <a href="{{ path('actor_new') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Nuevo Actor
        </a>
    </div>

    <form method="get" class="d-flex gap-2 flex-wrap align-items-center">

        <input
            type="text"
            name="q"
            value="{{ query|default('') }}"
            class="form-control"
            placeholder="Buscar actor"
            style="min-width: 200px;"
        >

        <!-- Orden -->
        <a href="{{ path('actor_index', { q: query, order: 'asc', page: currentPage }) }}"
           class="btn btn-outline-secondary {% if order == 'asc' %}active{% endif %}">
            A → Z
        </a>

        <a href="{{ path('actor_index', { q: query, order: 'desc', page: currentPage }) }}"
           class="btn btn-outline-secondary {% if order == 'desc' %}active{% endif %}">
            Z → A
        </a>

        <button class="btn btn-primary">
            <i class="bi bi-search"></i>
        </button>
    </form>
</div>

<!-- Información de registros -->
{% if totalItems > 0 %}
<div class="mb-3">
    <small class="text-muted">
        Mostrando {{ actors|length }} de {{ totalItems }} actores
        {% if totalPages > 1 %} - Página {{ currentPage }} de {{ totalPages }}{% endif %}
    </small>
</div>
{% endif %}

<!-- GRID DE ACTORES -->
<div class="row">
{% for actor in actors %}
    <div class="col-md-4 col-lg-3 mb-4">
        <div class="card shadow-sm h-100 border-0">
            <div class="card-body text-center">

                <div class="mb-2">
                    <i class="bi bi-person-circle fs-1 text-secondary"></i>
                </div>

                <h5 class="fw-bold mb-1">
                    {{ actor.lastName }} {{ actor.firstName }}
                </h5>

                <small class="text-muted">Actor</small>

                <div class="mt-3 d-flex justify-content-center gap-2">

                    <a href="{{ path('actor_show', { id: actor.actorId }) }}"
                       class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-eye"></i> Ver
                    </a>

                    <form method="post"
                          action="{{ path('actor_delete', { id: actor.actorId }) }}"
                          onsubmit="return confirm('¿Eliminar actor definitivamente?')"
                    >
                        <input type="hidden" name="_token"
                               value="{{ csrf_token('delete_actor_' ~ actor.actorId) }}">

                        <button class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>

                </div>
            </div>
        </div>
    </div>
{% else %}
    <div class="col-12">
        <div class="alert alert-warning text-center">
            <i class="bi bi-info-circle"></i> No se encontraron actores.
        </div>
    </div>
{% endfor %}
</div>

<!-- PAGINACIÓN -->
{% if totalPages > 1 %}
<nav aria-label="Paginación de actores" class="mt-4">
    <ul class="pagination justify-content-center">
        
        <!-- Botón Anterior -->
        <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
            <a class="page-link" 
               href="{{ path('actor_index', {page: currentPage - 1, q: query, order: order}) }}"
               aria-label="Anterior">
                <i class="bi bi-chevron-left"></i> Anterior
            </a>
        </li>

        <!-- Primera página -->
        {% if currentPage > 3 %}
            <li class="page-item">
                <a class="page-link" href="{{ path('actor_index', {page: 1, q: query, order: order}) }}">1</a>
            </li>
            {% if currentPage > 4 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}
        {% endif %}

        <!-- Páginas cercanas a la actual -->
        {% for page in range(max(1, currentPage - 2), min(totalPages, currentPage + 2)) %}
            <li class="page-item {% if page == currentPage %}active{% endif %}">
                <a class="page-link" 
                   href="{{ path('actor_index', {page: page, q: query, order: order}) }}">
                    {{ page }}
                </a>
            </li>
        {% endfor %}

        <!-- Última página -->
        {% if currentPage < totalPages - 2 %}
            {% if currentPage < totalPages - 3 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}
            <li class="page-item">
                <a class="page-link" 
                   href="{{ path('actor_index', {page: totalPages, q: query, order: order}) }}">
                    {{ totalPages }}
                </a>
            </li>
        {% endif %}

        <!-- Botón Siguiente -->
        <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
            <a class="page-link" 
               href="{{ path('actor_index', {page: currentPage + 1, q: query, order: order}) }}"
               aria-label="Siguiente">
                Siguiente <i class="bi bi-chevron-right"></i>
            </a>
        </li>
    </ul>
</nav>
{% endif %}

{% endblock %}