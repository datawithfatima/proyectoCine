{% extends 'base.html.twig' %}

{% block title %}Alquileres{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <h2 class="fw-bold mb-0">
        <i class="bi bi-film"></i> Alquileres
    </h2>

    <a href="{{ path('rental_new') }}" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Nuevo alquiler
    </a>
</div>

<form method="get" class="card p-3 mb-4 shadow-sm">
    <div class="row g-2">
        <div class="col-md-3">
            <input type="text" name="customer" class="form-control"
                   placeholder="Cliente (nombre/apellido)"
                   value="{{ customer|default('') }}">
        </div>
        <div class="col-md-3">
            <input type="text" name="film" class="form-control"
                   placeholder="Película"
                   value="{{ film|default('') }}">
        </div>
        <div class="col-md-2">
            <select name="status" class="form-select">
                <option value="">Todos</option>
                <option value="active"   {{ status == 'active'   ? 'selected' }}>Activos</option>
                <option value="returned" {{ status == 'returned' ? 'selected' }}>Devueltos</option>
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="from" class="form-control" value="{{ from|default('') }}"
                   placeholder="Desde">
        </div>
        <div class="col-md-2">
            <input type="date" name="to" class="form-control" value="{{ to|default('') }}"
                   placeholder="Hasta">
        </div>
    </div>
    <div class="mt-3 d-flex justify-content-end">
        <button class="btn btn-primary">
            <i class="bi bi-search"></i> Filtrar
        </button>
    </div>
</form>

{% if rentals is empty %}
    <div class="alert alert-warning">
        <i class="bi bi-info-circle"></i> No se encontraron alquileres.
    </div>
{% else %}
    <table class="table table-striped table-hover align-middle">
        <thead>
        <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Película</th>
            <th>Tienda</th>
            <th>Fecha alquiler</th>
            <th>Fecha devolución</th>
            <th>Estado</th>
            <th class="text-end">Acciones</th>
        </tr>
        </thead>
        <tbody>
        {% for r in rentals %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.customer.fullName }}</td>
                <td>{{ r.inventory.film.title }}</td>
                <td>Tienda {{ r.inventory.store.storeId }}</td>
                <td>{{ r.rentalDate|date('Y-m-d H:i') }}</td>
                <td>
                    {% if r.returnDate %}
                        {{ r.returnDate|date('Y-m-d H:i') }}
                    {% else %}
                        <span class="text-muted">En curso</span>
                    {% endif %}
                </td>
                <td>
                    {% if r.returnDate %}
                        <span class="badge bg-secondary">Devuelto</span>
                    {% else %}
                        <span class="badge bg-success">Activo</span>
                    {% endif %}
                </td>
                <td class="text-end">
                    <a href="{{ path('rental_show', {id: r.id}) }}"
                       class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                    </a>
                    {% if not r.returnDate %}
                        <a href="{{ path('rental_return', {id: r.id}) }}"
                           class="btn btn-sm btn-outline-warning">
                            <i class="bi bi-arrow-return-left"></i> Devolver
                        </a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endif %}
{% endblock %}
